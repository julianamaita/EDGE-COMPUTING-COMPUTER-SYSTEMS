#include <Servo.h>
#include <LiquidCrystal.h>

const int rs = 3, en = 4, d4 = A3, d5 = A4, d6 = A5, d7 = 5;
LiquidCrystal lcd(rs, en, d4, d5, d6, d7);

int servoPin = 13;
int ledRed = 12;
int ledGreen = 11;
int buzzer = 10;

Servo servo1;

void setup()
{
  lcd.begin(16, 2);
  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("Inicializando");
  delay(1000);
  
  lcd.clear();
  
  pinMode(ledRed, OUTPUT);
  pinMode(ledGreen, OUTPUT);
  pinMode(buzzer, OUTPUT);
  servo1.attach(servoPin);
  Serial.begin(9600);
}

void loop()
{
  int luz = analogRead(A0);
  int luzPorcentagem = map(luz, 0, 1023, -5, 105);
  
  int humiditySensor = analogRead(A2);
  int umidade = map(humiditySensor, 0, 1023, 10, 100);
  
  int temperaturaValue = analogRead(A1);
  float tensao = temperaturaValue * 5;
  tensao /= 1024;
  float temperatura = (tensao - 0.5) * 100;
  
  Serial.println(temperatura);
  Serial.println(luzPorcentagem);
  Serial.println(umidade);
  
  if(luzPorcentagem >= 80) {
  	servo1.write(180);
    while(true) {
    	lcd.setCursor(0, 0);
    	lcd.print("Janelas");
    	lcd.setCursor(0, 1);
    	lcd.print("Abertas");
    	delay(1500);
    	lcd.clear();
      
      	lcd.setCursor(0, 0);
    	lcd.print("Temp: ");
    	lcd.setCursor(0, 1);
    	lcd.print(temperatura);
      	lcd.print("C");
    	delay(1500);
    	lcd.clear();
      
      	lcd.setCursor(0, 0);
    	lcd.print("Umidade: ");
    	lcd.setCursor(0, 1);
    	lcd.print(umidade);
    	delay(1500);
    	lcd.clear();
      	break;
    }
  } else {
    servo1.write(0);
    while(true) {
    	lcd.setCursor(0, 0);
    	lcd.print("Janelas");
    	lcd.setCursor(0, 1);
    	lcd.print("Fechadas");
    	delay(1500);
    	lcd.clear();
      
      	lcd.setCursor(0, 0);
    	lcd.print("Temp: ");
    	lcd.setCursor(0, 1);
    	lcd.print(temperatura);
      	lcd.print("C");
    	delay(1500);
    	lcd.clear();
      
      	lcd.setCursor(0, 0);
    	lcd.print("Umidade: ");
    	lcd.setCursor(0, 1);
    	lcd.print(umidade);
    	delay(1500);
    	lcd.clear();
      	break;
    }
  }
  
  int umidadeBoa = umidade >= 10 && umidade <= 30;
  
  if(temperatura <= 35 && umidadeBoa) {
  	digitalWrite(ledGreen, HIGH);
    digitalWrite(ledRed, LOW);
    
    digitalWrite(buzzer, LOW);
  } else {
  	digitalWrite(ledRed, HIGH);
    digitalWrite(ledGreen, LOW);
    
    while(true) {
    	digitalWrite(buzzer, HIGH);
    	delay(3000);
    	digitalWrite(buzzer, LOW);
      	delay(3000);
     	break;
    }
  }
}
